flowchart TB
    subgraph External["External Data Sources"]
        SENSORS["IoT Sensors<br/>Water Level, Rainfall"]
        WEATHER["Weather APIs"]
    end
    
    subgraph F3["F3 - Forecasting Service"]
        direction TB
        API["FastAPI REST API<br/>Port 8002"]
        ML["ML Engine"]
        MODELS["Trained Models<br/>RF, GB, LSTM"]
        RISK["Risk Assessment"]
    end
    
    subgraph Consumers["Service Consumers"]
        F1["F1 - IoT Irrigation<br/>Service"]
        F4["F4 - Optimization<br/>Service"]
        WEB["Web Dashboard<br/>React Frontend"]
    end
    
    subgraph Storage["Data Layer"]
        DB[("PostgreSQL +<br/>TimescaleDB")]
    end
    
    SENSORS -->|"Sensor Data"| API
    WEATHER -->|"Weather Data"| API
    API --> ML
    ML --> MODELS
    ML --> RISK
    API -->|"Forecasts"| F1
    API -->|"Water Availability"| F4
    API -->|"Charts & Alerts"| WEB
    API <-->|"Historical Data"| DB